[项目技术创新点（可持续补充）]

一、图片本地化与安全治理（后端）
1) 外链图片本地化工具链
- utils.FetchAndStoreImage：HTTP 超时、最多 3 次跳转、MIME 白名单、5MB 上限、SSRF 防护、内容嗅探、内容哈希命名与去重。
- utils.StoreLocalImageFromPath：从本地前端资源导入到后端统一 images 目录，自动嗅探 MIME、哈希命名、避免重复存储。
- 按业务分区与分桶：uploads/images/content/YYYY/MM、uploads/images/media/YYYY/MM、uploads/images/articles/YYYY/MM，便于 CDN、容量统计与清理。

2) 在线与离线双通道接入
- 在线流程：创建/更新文章与媒体时若封面为外链，自动转存站内并替换 URL（与权限/校验深度集成）。
- 离线批处理：新增迁移脚本与管理端点（文章与媒体），一次性扫描历史数据、批量本地化、原子更新数据库。

二、前端交互与体验突破
1) 统一“书影集”界面与双列信息架构
- 将小说/书单/电影合并为单页，左侧图+可编辑说明，右侧长列表行卡片（无图），首行标题+评分，次行时间。
- 行卡片自适配布局与细粒度信息分离，提高可读性与移动端滚动效率。

2) 卡片“现代流光”交互动画
- 去除传统升起阴影，改为四边流光动画；统一线宽、无停顿、边角连续不被圆角裁剪，提升现代感与性能稳定性。

3) 移动端分页到无限滚动的策略切换
- 使用 IntersectionObserver 替代分页（移动端）；加 nextTick + 轻微延时，解决“渲染期更新”与空节点观测导致的运行时异常；
- 自动隐藏分页（当只有一页或移动端），交互一致性更好。

4) 全局提示与 Live2D 看板娘的场景化协同
- 依据路由与页面场景动态触发欢迎语；媒体弹框按类型（小说/书/电影）1/4 概率触发对应台词；
- 统一消息优先级与去重（sessionStorage），避免提示干扰；修正 z-index 与 backdrop-filter 场景下的虚化问题。

5) Markdown 渲染安全链路
- 使用 marked + DOMPurify，统一渲染与消毒；在弹框与卡片展示中分别优化字号/行高/滚动隐藏。

三、导航、搜索与可用性增强
1) 导航折叠自适应与“更多”模态
- 双阶段测量与阈值快速裁决，避免布局抖动；小屏用模态方式展示完整导航，统一模态视觉组件。

2) 搜索模态体验
- Teleport 到 body，带背景虚化与滚动性能优化；
- 关键词分割检索多数据源（博客/随笔/研究/项目），异步防抖与 Skeleton/空态处理。

3) 复制邮箱快捷操作
- Clipboard API 首选，回退 execCommand，桌面端用看板娘消息、移动端用原生 alert，覆盖率高、提示友好。

四、稳健性与跨端优化
1) 图片加载回退策略
- 头像失败自动回退本地生成的默认头像（Canvas 生成），提升健壮性；媒体与文章封面具备可扩展的 fallback 钩子位。

2) DevServer 静态代理
- 在开发环境将 /uploads 代理到后端，解决前后端端口分离导致的图片 404 与权限问题，贴近生产部署拓扑。

五、工程化与可运维性
1) 目录治理与可扩展部署
- 静态映射：/uploads → ./uploads；建议生产用 Nginx 直出 uploads 目录、强缓存与压缩。
- 通过“哈希命名+分桶”实现去重与后续可观测的冗余清理（可做引用扫描工具）。

2) 质量控制与一致性
- ESLint 规则修复：v-for key、空行、未使用变量等；
- UI 变量化（阴影/圆角/主色）与一致性推进的落点位保留。

六、已解决的典型疑难问题（代表性）
- 图片 404（开发环境）→ devServer 代理 /uploads 到后端，前端路径无须改动。
- 无限滚动运行时错误（component 为 null）→ nextTick 保证 DOM 存在，再延迟触发加载，避免渲染期状态修改。
- “暂无内容”误显 → 精确化显示条件，移动端关闭。
- 书影集合并后路由 404 → 保存后导航路径修正到 /fragments/{type}。
- 看板娘被遮罩虚化 → 提升 z-index、fixed 定位、移动端隐藏策略。

七、网络性能优化（2025年11月）
1) Nginx 服务器优化
- HTTP/2 协议启用：多路复用、头部压缩、服务器推送能力，相比 HTTP/1.1 显著提升并发性能。
- Gzip 压缩优化：压缩级别 6（性能与压缩率平衡）、最小文件 256B、支持所有文本资源（HTML/CSS/JS/JSON/XML）。
- 缓存策略分层：HTML 不缓存（确保更新及时）、JS/CSS/字体 365 天长期缓存（通过文件名哈希实现版本控制）、图片 90 天缓存、静态资源不记录访问日志减少 I/O。
- 连接优化：keepalive_timeout 65s、keepalive_requests 100、tcp_nodelay 和 tcp_nopush 启用，减少连接开销。

2) 前端资源优化
- DNS 预解析与预连接：通过 `<link rel="dns-prefetch">` 和 `<link rel="preconnect">` 提前建立连接，减少 DNS 查询和 TCP 握手时间。
- 代码分割精细化：Highlight.js 单独打包（按需加载）、运行时 chunk 独立提取（便于长期缓存）、优化 vendor 和 markdown 包体积。
- 构建优化：生产环境禁用 source map（减小 30-50% 构建体积）、启用性能提示（entrypoint 和 asset 上限 500KB）、优化代码分割参数。

3) 压缩与传输优化
- 文本资源压缩：Gzip 对所有文本资源启用，压缩率 60-80%；预留 Brotli 配置（需安装 nginx-module-brotli，压缩率比 Gzip 高 15-20%）。
- 图片优化建议：WebP/AVIF 格式支持（通过 Cloudflare 自动转换或后端处理）、响应式图片（srcset/sizes）、图片懒加载（`loading="lazy" decoding="async"`）。
- 静态资源分离：JS/CSS/字体与图片分别配置缓存策略，CSS/JS 使用 `immutable` 缓存头，图片使用普通 `public` 缓存。

4) Cloudflare CDN 集成
- CDN 加速：所有静态资源通过 Cloudflare CDN 分发，利用全球边缘节点减少延迟。
- 智能缓存：Cloudflare 自动缓存静态资源，通过 `cf-cache-status: HIT` 头部监控缓存命中率。
- 自动图片优化：Cloudflare 支持自动转换为 WebP/AVIF 格式（需在 CF 控制台启用）。

5) 性能监控与优化建议
- 图片压缩效果：70KB JPEG 压缩后可减少 40-60% 体积，加载时间减少 0.5-1.5 秒（取决于网络速度）。
- 预期性能提升：首屏加载时间减少 20-30%、页面交互时间（TTI）减少 15-25%、带宽使用减少 40-60%（文本资源压缩）。
- 待实施优化：Brotli 压缩启用、图片响应式加载（srcset）、关键资源预加载（preload）、HTTP/2 Server Push（需 Nginx 1.13.9+）。

八、可继续演进的方向（预研位）
- 图片多规格生成（WebP/AVIF 与缩略图）；前端 srcset/sizes 响应式加载。
- 列表接口缓存与 ETag/Last-Modified；Nginx 静态层 Cache-Control。
- 错误上报与慢查询监控；批处理幂等重试与断点续传。
- 安全进一步精细化：CORS 白名单、扩展名白名单+二次嗅探、防脚本上传执行。
- Brotli 压缩启用（需安装 nginx-module-brotli 模块）。
- 服务端图片处理：上传时自动生成多尺寸缩略图、WebP 格式转换、图片质量优化。

（本文件会随后续优化持续补充。）
