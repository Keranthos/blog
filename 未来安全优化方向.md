# 未来安全优化方向

本文件汇总当前博客项目中发现的安全风险与建议的整改措施，供后续迭代时参考。

## 一、立即修补的高危问题

1. **注册接口可直接提权到管理员**  
   - 问题：`/api/auth/register` 在写库前未重置 `level` 字段，客户端可传入 `level: 3` 获得管理员权限。
   - 行动：注册时强制写入普通用户等级（或关闭匿名注册），并审计库中现有账号。

2. **默认管理员账号与固定弱密码**  
   - 问题：启动时自动创建用户名 `山角函兽`、默认密码 `ChangeMe123!` 的管理员。
   - 行动：通过环境变量注入强密码，生产环境禁止自动创建；检查现网是否仍使用默认凭据。

3. **JWT 秘钥与令牌写入日志**  
   - 问题：签发 JWT 时会 `log.Println` 输出秘钥和 token，任何能访问日志的人都可伪造身份。
   - 行动：移除相关日志并清理历史日志；改用安全的审计方案追踪登录行为。

4. **静态目录完全暴露**  
   - 问题：`r.Static("/uploads", "./uploads")` 直接对外映射，支持目录遍历，所有上传内容无鉴权可访问。（目前文章头图与文章内部的图片都是公开的资源，完全暴露没有任何风险）
   - 行动：按资源类型拆分目录；关闭目录索引；对敏感文件新增鉴权或迁移到对象存储/CDN。

5. **文件上传缺少深度校验**  
   - 问题：仅靠 `Content-Type` 判断图片类型，保存时拼接原始文件名，存在伪装扩展名、目录穿越、XSS 风险。
   - 行动：增加魔数检测、扩展名白名单、重命名（UUID），并考虑在上传后生成安全访问 URL。

## 二、短期加固措施

1. **配置与凭据管理**  
   - 将数据库口令、JWT 秘钥等敏感信息迁移到环境变量或秘密管理器，仓库中改为示例文件。

2. **权限与鉴权**  
   - 审核所有需要 `level` ≥ 1 的接口，确认权限策略；对敏感操作添加二次校验或 CSRF 防护。

3. **日志与监控**  
   - 统一日志等级，避免输出敏感数据；引入登录/注册异常监控与告警。

4. **接口限流与防刷**  
   - 对登录、注册、评论等接口增加 IP 与账号维度的速率限制，减轻暴力破解与 spam。

5. **输入校验与内容过滤**  
   - 后端增强对 Markdown/HTML 内容的 XSS 过滤（例如统一使用 DOMPurify 的安全白名单或在后台复查）。

## 三、中长期规划

1. **访问控制体系化**  
   - 引入 RBAC/ABAC，拆分普通用户、作者、管理员权限；维护权限映射表与审批流程。

2. **文件与媒体安全**  
   - 迁移至对象存储服务，配合签名 URL、防盗链策略、CDN 缓存与日志分析。

3. **安全测试与自动化**  
   - 建立安全扫描、依赖漏洞检测、CI 安全测试流程；定期进行渗透测试或对关键模块做 Threat Modeling。

4. **应急响应**  
   - 定义安全事件响应手册，梳理日志保留、快速封禁、凭据轮换等操作步骤。

5. **数据隐私治理**  
   - 区分公开数据与私密数据，必要时对敏感字段做脱敏/加密存储，满足后续隐私合规需求。

---

> 若未来需要更详细的整改计划或实施指导，可在对应项目阶段逐条展开。

